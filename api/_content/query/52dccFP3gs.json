{"_path":"/til/swap","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Gerenciamento de memória swap","description":"Configuração de arquivo de swap","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"configuração-atual"},"children":[{"type":"text","value":"Configuração atual"}]},{"type":"element","tag":"code","props":{"code":"swapon --show\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swapon --show\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A saída do comando acima, se tiver swap configurado, será parecido com:"}]},{"type":"element","tag":"code","props":{"code":"NAME      TYPE      SIZE USED PRIO\n/dev/sda5 partition 2,9G   1G   -2\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"NAME      TYPE      SIZE USED PRIO\n/dev/sda5 partition 2,9G   1G   -2\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Neste caso uma partição foi utilizada para swap."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outro modo de verificar o swap é:"}]},{"type":"element","tag":"code","props":{"code":"free -h\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"free -h\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Na ausência o valor é informado como zero."}]},{"type":"element","tag":"code","props":{"code":"Mem:          996Mi       262Mi        79Mi        40Mi       654Mi       514Mi\nSwap:            0B          0B          0B\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Mem:          996Mi       262Mi        79Mi        40Mi       654Mi       514Mi\nSwap:            0B          0B          0B\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"verificar-se-existe-espaço-disponível-para-criação"},"children":[{"type":"text","value":"Verificar se existe espaço disponível para criação"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Antes de criar o swap é necessário garantir que existe espaço em disco."}]},{"type":"element","tag":"code","props":{"code":"$ df -ah\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ df -ah\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Saída"}]},{"type":"element","tag":"code","props":{"code":"Filesystem      Size  Used Avail Use% Mounted on\nsysfs              0     0     0    - /sys\nproc               0     0     0    - /proc\nudev            488M     0  488M   0% /dev\ndevpts             0     0     0    - /dev/pts\ntmpfs           100M   13M   88M  13% /run\n/dev/vda1        25G   11G   14G  45% /\nsecurityfs         0     0     0    - /sys/kernel/security\ntmpfs           499M   12K  499M   1% /dev/shm\ntmpfs           5.0M     0  5.0M   0% /run/lock\ntmpfs           499M     0  499M   0% /sys/fs/cgroup\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Filesystem      Size  Used Avail Use% Mounted on\nsysfs              0     0     0    - /sys\nproc               0     0     0    - /proc\nudev            488M     0  488M   0% /dev\ndevpts             0     0     0    - /dev/pts\ntmpfs           100M   13M   88M  13% /run\n/dev/vda1        25G   11G   14G  45% /\nsecurityfs         0     0     0    - /sys/kernel/security\ntmpfs           499M   12K  499M   1% /dev/shm\ntmpfs           5.0M     0  5.0M   0% /run/lock\ntmpfs           499M     0  499M   0% /sys/fs/cgroup\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"criação-do-arquivo-de-swap"},"children":[{"type":"text","value":"Criação do arquivo de swap"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Como a memória do sistema é de 1GB vamos criar um arquivo de swap com 2GB no raiz."}]},{"type":"element","tag":"code","props":{"code":"fallocate -l 2G /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"fallocate -l 2G /swapfile\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"O acesso deve ser somente do root:"}]},{"type":"element","tag":"code","props":{"code":"chown root.root /swapfile\nchmod 600 /swapfile\nls -lh /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"chown root.root /swapfile\nchmod 600 /swapfile\nls -lh /swapfile\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Saída"}]},{"type":"element","tag":"code","props":{"code":"-rw------- 1 root root 2.0G Aug 10 09:45 /swapfile\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"-rw------- 1 root root 2.0G Aug 10 09:45 /swapfile\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Com as permissões corretas podemos continuar marcando o espaço como swap:"}]},{"type":"element","tag":"code","props":{"code":"mkswap /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"mkswap /swapfile\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)\nno label, UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)\nno label, UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"ativando-o-swap"},"children":[{"type":"text","value":"Ativando o swap"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Depois de marcado podemos disponibilizar o swap para o sistema."}]},{"type":"element","tag":"code","props":{"code":"swapon /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"swapon /swapfile\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"NAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"NAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vamos verificar como os comando que já vimos anteriormente:"}]},{"type":"element","tag":"code","props":{"code":"$ swapon --show\nNAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1\n\n$ free -h\n              total        used        free      shared  buff/cache   available\nMem:          996Mi       263Mi        74Mi        40Mi       658Mi       513Mi\nSwap:         2.0Gi          0B       2.0Gi\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ swapon --show\nNAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1\n\n$ free -h\n              total        used        free      shared  buff/cache   available\nMem:          996Mi       263Mi        74Mi        40Mi       658Mi       513Mi\nSwap:         2.0Gi          0B       2.0Gi\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"tornando-o-swap-permanente"},"children":[{"type":"text","value":"Tornando o swap permanente"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Primeiramente faremos um backup do arquivo fstab"}]},{"type":"element","tag":"code","props":{"code":"cp /etc/fstab /etc/fstab.bak\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cp /etc/fstab /etc/fstab.bak\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Agora vamos acrescentar uma linha no final do fstab"}]},{"type":"element","tag":"code","props":{"code":"echo '/swapfile none swap sw 0 0' | tee -a /etc/fstab\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"echo '/swapfile none swap sw 0 0' | tee -a /etc/fstab\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"ajustes-finos"},"children":[{"type":"text","value":"Ajustes finos"}]},{"type":"element","tag":"h3","props":{"id":"swappiness"},"children":[{"type":"text","value":"Swappiness"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Este parâmetro, que varia de 0 a 100, ajusta a frequência de acesso ao swap"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"próximos a 0: o sistema só acessa o swap se absolutamente necessário (mais rápido)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"próximos a 100: prioriza colocar os dados no swap para liberar RAM"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"desktop: 60"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server: 10"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para verificar a configuração atual use:"}]},{"type":"element","tag":"code","props":{"code":"cat /proc/sys/vm/swappiness\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cat /proc/sys/vm/swappiness\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para definir o valor 10 use:"}]},{"type":"element","tag":"code","props":{"code":"sysctl vm.swappiness=10\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sysctl vm.swappiness=10\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para deixar permanente a configuração:"}]},{"type":"element","tag":"code","props":{"code":"cp /etc/sysctl.conf /etc/sysctl.conf.bak\necho 'vm.swappiness=10' | tee -a /etc/sysctl.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cp /etc/sysctl.conf /etc/sysctl.conf.bak\necho 'vm.swappiness=10' | tee -a /etc/sysctl.conf\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"cache-pressure"},"children":[{"type":"text","value":"Cache pressure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Usado para realizar cache de informações de "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inode"}]},{"type":"text","value":" e "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dentry"}]},{"type":"text","value":" possibilitando reduzir o custo de acessar esta informações frequentemente."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para verificar o valor atual use:"}]},{"type":"element","tag":"code","props":{"code":"cat /proc/sys/vm/vfs_cache_pressure\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cat /proc/sys/vm/vfs_cache_pressure\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Saída"}]},{"type":"element","tag":"code","props":{"code":"100\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"100\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Da maneira como está agora o sistema removerá as informações sobre "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inode"}]},{"type":"text","value":" muito rapidamente.\nVamos adotar uma configuração mais conservativa utilizando o valor 50."}]},{"type":"element","tag":"code","props":{"code":"sysctl vm.vfs_cache_pressure=50\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sysctl vm.vfs_cache_pressure=50\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para deixar permanente a configuração"}]},{"type":"element","tag":"code","props":{"code":"echo 'vm.vfs_cache_pressure=50' | tee -a /etc/sysctl.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"echo 'vm.vfs_cache_pressure=50' | tee -a /etc/sysctl.conf\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"referências"},"children":[{"type":"text","value":"Referências"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-16-04","rel":["nofollow"]},"children":[{"type":"text","value":"How To Add Swap Space on Ubuntu 16.04"}]}]}]}]},"date":"2019-12-02T00:00:00.000Z","draft":false,"tags":["swap","debian"],"Thumbnail":"img/headers/debian.webp","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"configuração-atual"},"children":[{"type":"text","value":"Configuração atual"}]},{"type":"element","tag":"code","props":{"code":"swapon --show\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"swapon --show"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A saída do comando acima, se tiver swap configurado, será parecido com:"}]},{"type":"element","tag":"code","props":{"code":"NAME      TYPE      SIZE USED PRIO\n/dev/sda5 partition 2,9G   1G   -2\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"NAME      TYPE      SIZE USED PRIO"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"/dev/sda5 partition 2,9G   1G   -2"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Neste caso uma partição foi utilizada para swap."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Outro modo de verificar o swap é:"}]},{"type":"element","tag":"code","props":{"code":"free -h\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"free -h"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Na ausência o valor é informado como zero."}]},{"type":"element","tag":"code","props":{"code":"Mem:          996Mi       262Mi        79Mi        40Mi       654Mi       514Mi\nSwap:            0B          0B          0B\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"Mem:          996Mi       262Mi        79Mi        40Mi       654Mi       514Mi"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"Swap:            0B          0B          0B"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"verificar-se-existe-espaço-disponível-para-criação"},"children":[{"type":"text","value":"Verificar se existe espaço disponível para criação"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Antes de criar o swap é necessário garantir que existe espaço em disco."}]},{"type":"element","tag":"code","props":{"code":"$ df -ah\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"$ df -ah"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Saída"}]},{"type":"element","tag":"code","props":{"code":"Filesystem      Size  Used Avail Use% Mounted on\nsysfs              0     0     0    - /sys\nproc               0     0     0    - /proc\nudev            488M     0  488M   0% /dev\ndevpts             0     0     0    - /dev/pts\ntmpfs           100M   13M   88M  13% /run\n/dev/vda1        25G   11G   14G  45% /\nsecurityfs         0     0     0    - /sys/kernel/security\ntmpfs           499M   12K  499M   1% /dev/shm\ntmpfs           5.0M     0  5.0M   0% /run/lock\ntmpfs           499M     0  499M   0% /sys/fs/cgroup\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"Filesystem      Size  Used Avail Use% Mounted on\nsysfs              0     0     0    - /sys\nproc               0     0     0    - /proc\nudev            488M     0  488M   0% /dev\ndevpts             0     0     0    - /dev/pts\ntmpfs           100M   13M   88M  13% /run\n/dev/vda1        25G   11G   14G  45% /\nsecurityfs         0     0     0    - /sys/kernel/security\ntmpfs           499M   12K  499M   1% /dev/shm\ntmpfs           5.0M     0  5.0M   0% /run/lock\ntmpfs           499M     0  499M   0% /sys/fs/cgroup"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"criação-do-arquivo-de-swap"},"children":[{"type":"text","value":"Criação do arquivo de swap"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Como a memória do sistema é de 1GB vamos criar um arquivo de swap com 2GB no raiz."}]},{"type":"element","tag":"code","props":{"code":"fallocate -l 2G /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"fallocate -l 2G /swapfile"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"O acesso deve ser somente do root:"}]},{"type":"element","tag":"code","props":{"code":"chown root.root /swapfile\nchmod 600 /swapfile\nls -lh /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"chown root.root /swapfile"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"chmod 600 /swapfile"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"ls -lh /swapfile"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Saída"}]},{"type":"element","tag":"code","props":{"code":"-rw------- 1 root root 2.0G Aug 10 09:45 /swapfile\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"-rw------- 1 root root 2.0G Aug 10 09:45 /swapfile"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Com as permissões corretas podemos continuar marcando o espaço como swap:"}]},{"type":"element","tag":"code","props":{"code":"mkswap /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"mkswap /swapfile"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)\nno label, UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)\nno label, UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"ativando-o-swap"},"children":[{"type":"text","value":"Ativando o swap"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Depois de marcado podemos disponibilizar o swap para o sistema."}]},{"type":"element","tag":"code","props":{"code":"swapon /swapfile\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"swapon /swapfile"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"NAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"NAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vamos verificar como os comando que já vimos anteriormente:"}]},{"type":"element","tag":"code","props":{"code":"$ swapon --show\nNAME      TYPE SIZE USED PRIO\n/swapfile file   2G   0B   -1\n\n$ free -h\n              total        used        free      shared  buff/cache   available\nMem:          996Mi       263Mi        74Mi        40Mi       658Mi       513Mi\nSwap:         2.0Gi          0B       2.0Gi\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"$ swapon --show"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"NAME      TYPE SIZE USED PRIO"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"/swapfile file   2G   0B   -1"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"$ free -h"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"              total        used        free      shared  buff/cache   available"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"Mem:          996Mi       263Mi        74Mi        40Mi       658Mi       513Mi"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"Swap:         2.0Gi          0B       2.0Gi"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"tornando-o-swap-permanente"},"children":[{"type":"text","value":"Tornando o swap permanente"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Primeiramente faremos um backup do arquivo fstab"}]},{"type":"element","tag":"code","props":{"code":"cp /etc/fstab /etc/fstab.bak\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"cp /etc/fstab /etc/fstab.bak"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Agora vamos acrescentar uma linha no final do fstab"}]},{"type":"element","tag":"code","props":{"code":"echo '/swapfile none swap sw 0 0' | tee -a /etc/fstab\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8e2937"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e39a8c"},"children":[{"type":"text","value":"'/swapfile none swap sw 0 0'"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-623ca0"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" tee -a /etc/fstab"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"ajustes-finos"},"children":[{"type":"text","value":"Ajustes finos"}]},{"type":"element","tag":"h3","props":{"id":"swappiness"},"children":[{"type":"text","value":"Swappiness"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Este parâmetro, que varia de 0 a 100, ajusta a frequência de acesso ao swap"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"próximos a 0: o sistema só acessa o swap se absolutamente necessário (mais rápido)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"próximos a 100: prioriza colocar os dados no swap para liberar RAM"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"desktop: 60"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"server: 10"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para verificar a configuração atual use:"}]},{"type":"element","tag":"code","props":{"code":"cat /proc/sys/vm/swappiness\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"cat /proc/sys/vm/swappiness"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para definir o valor 10 use:"}]},{"type":"element","tag":"code","props":{"code":"sysctl vm.swappiness=10\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"sysctl vm.swappiness=10"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para deixar permanente a configuração:"}]},{"type":"element","tag":"code","props":{"code":"cp /etc/sysctl.conf /etc/sysctl.conf.bak\necho 'vm.swappiness=10' | tee -a /etc/sysctl.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"cp /etc/sysctl.conf /etc/sysctl.conf.bak"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8e2937"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e39a8c"},"children":[{"type":"text","value":"'vm.swappiness=10'"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-623ca0"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" tee -a /etc/sysctl.conf"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"cache-pressure"},"children":[{"type":"text","value":"Cache pressure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Usado para realizar cache de informações de "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inode"}]},{"type":"text","value":" e "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dentry"}]},{"type":"text","value":" possibilitando reduzir o custo de acessar esta informações frequentemente."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para verificar o valor atual use:"}]},{"type":"element","tag":"code","props":{"code":"cat /proc/sys/vm/vfs_cache_pressure\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"cat /proc/sys/vm/vfs_cache_pressure"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Saída"}]},{"type":"element","tag":"code","props":{"code":"100\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"100"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Da maneira como está agora o sistema removerá as informações sobre "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"inode"}]},{"type":"text","value":" muito rapidamente.\nVamos adotar uma configuração mais conservativa utilizando o valor 50."}]},{"type":"element","tag":"code","props":{"code":"sysctl vm.vfs_cache_pressure=50\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":"sysctl vm.vfs_cache_pressure=50"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Para deixar permanente a configuração"}]},{"type":"element","tag":"code","props":{"code":"echo 'vm.vfs_cache_pressure=50' | tee -a /etc/sysctl.conf\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-8e2937"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e39a8c"},"children":[{"type":"text","value":"'vm.vfs_cache_pressure=50'"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-623ca0"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-516840"},"children":[{"type":"text","value":" tee -a /etc/sysctl.conf"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"referências"},"children":[{"type":"text","value":"Referências"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-16-04","rel":["nofollow"]},"children":[{"type":"text","value":"How To Add Swap Space on Ubuntu 16.04"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-623ca0{color:#F92672}.ct-e39a8c{color:#E6DB74}.ct-8e2937{color:#66D9EF}.ct-516840{color:#F8F8F2}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"configuração-atual","depth":2,"text":"Configuração atual"},{"id":"verificar-se-existe-espaço-disponível-para-criação","depth":2,"text":"Verificar se existe espaço disponível para criação"},{"id":"criação-do-arquivo-de-swap","depth":2,"text":"Criação do arquivo de swap"},{"id":"ativando-o-swap","depth":2,"text":"Ativando o swap"},{"id":"tornando-o-swap-permanente","depth":2,"text":"Tornando o swap permanente"},{"id":"ajustes-finos","depth":2,"text":"Ajustes finos","children":[{"id":"swappiness","depth":3,"text":"Swappiness"},{"id":"cache-pressure","depth":3,"text":"Cache pressure"}]},{"id":"referências","depth":2,"text":"Referências"}]}},"_type":"markdown","_id":"content:til:swap.md","_source":"content","_file":"til/swap.md","_extension":"md"}