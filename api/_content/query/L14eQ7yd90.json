[{"_path":"/til/certbot-hooks","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Certbot Hooks","description":"Como executar comandos juntos com o processo de obtenção de certificados SSL.","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"exemplo"},"children":[{"type":"text","value":"Exemplo"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Exemplos retirados de "},{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-the-mosquitto-mqtt-messaging-broker-on-debian-8","rel":["nofollow"]},"children":[{"type":"text","value":"How to Install and Secure the Mosquitto MQTT Messaging Broker on Debian 8"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"O certbot utiliza as portas 80 (HTTP) e 443 (HTTPS)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vamos usar apenas a porta 80."}]},{"type":"element","tag":"code","props":{"code":"sudo ufw allow http\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo ufw allow http\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"sudo certbot certonly --standalone --standalone-supported-challenges http-01 -d mqtt.example.com\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo certbot certonly --standalone --standalone-supported-challenges http-01 -d mqtt.example.com\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"crontab -e\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"crontab -e\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"15 3 * * * certbot renew --noninteractive --post-hook \"systemctl restart mosquitto\"\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"15 3 * * * certbot renew --noninteractive --post-hook \"systemctl restart mosquitto\"\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"opções"},"children":[{"type":"text","value":"Opções"}]},{"type":"element","tag":"h3","props":{"id":"--pre-hook-pre_hook"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--pre-hook PRE_HOOK"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comando a ser executado antes de obter um certificado.\nSe existirem vários hooks iguais somente um será executado."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Parar um servidor."}]}]},{"type":"element","tag":"h3","props":{"id":"--post-hook-post_hook"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--post-hook POST_HOOK"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comando a ser executado depois da tentativa de obter ou renovar o certificado.\nSe existirem vários hooks iguais somente um será executado."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Reiniciar/iniciar um servidor"}]}]},{"type":"element","tag":"h3","props":{"id":"--deploy-hook-deploy_hook"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--deploy-hook DEPLOY_HOOK"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comando a ser executado uma vez para cada certificado emitido.\nSão passados as seguintes variáveis para o shell:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"RENEWED_LINEAGE"}]},{"type":"text","value":" contendo o caminho certificado (p.e.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/letsencrypt/live/geraldo.dev"}]},{"type":"text","value":") que contém a chaves e o certificado."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"RENEWED_DOMAINS"}]},{"type":"text","value":" contem uma lista separada por espaço dos certificados renovados (p.e. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"geraldo.dev www.geraldo.dev"}]},{"type":"text","value":")"}]}]},{"type":"element","tag":"h3","props":{"id":"--disable-hook-validation"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--disable-hook-validation"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Manual: Ordinarily the commands specified for --pre-\nhook/--post-hook/--deploy-hook will be checked for validity, to see if the\nprograms being run are in the $PATH, so that mistakes can be caught early, even\nwhen the hooks aren't being run just yet. The validation is rather simplistic\nand fails if you use more advanced shell constructs, so you can use this switch\nto disable it. (default: False)"}]}]},{"type":"element","tag":"h3","props":{"id":"--no-directory-hooks"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--no-directory-hooks"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Manual: Disable running executables found in Certbot's hook directories\nduring renewal. (default: False)"}]}]},{"type":"element","tag":"h2","props":{"id":"referências"},"children":[{"type":"text","value":"Referências"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-the-mosquitto-mqtt-messaging-broker-on-debian-8","rel":["nofollow"]},"children":[{"type":"text","value":"How to Install and Secure the Mosquitto MQTT Messaging Broker on Debian 8"}]}]}]}]},"date":"2020-06-29T00:00:00.000Z","draft":false,"tags":["certbot","hooks","letsencrypt"],"linenos":false,"Thumbnail":"img/headers/certbot.png","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"exemplo"},"children":[{"type":"text","value":"Exemplo"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Exemplos retirados de "},{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-the-mosquitto-mqtt-messaging-broker-on-debian-8","rel":["nofollow"]},"children":[{"type":"text","value":"How to Install and Secure the Mosquitto MQTT Messaging Broker on Debian 8"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"O certbot utiliza as portas 80 (HTTP) e 443 (HTTPS)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vamos usar apenas a porta 80."}]},{"type":"element","tag":"code","props":{"code":"sudo ufw allow http\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":"sudo ufw allow http"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"sudo certbot certonly --standalone --standalone-supported-challenges http-01 -d mqtt.example.com\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":"sudo certbot certonly --standalone --standalone-supported-challenges http-01 -d mqtt.example.com"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"crontab -e\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":"crontab -e"}]}]}]}]}]},{"type":"element","tag":"code","props":{"code":"15 3 * * * certbot renew --noninteractive --post-hook \"systemctl restart mosquitto\"\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":"15 3 "}]},{"type":"element","tag":"span","props":{"class":"ct-d284ed"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d284ed"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d284ed"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-acdc60"},"children":[{"type":"text","value":" certbot renew --noninteractive --post-hook "}]},{"type":"element","tag":"span","props":{"class":"ct-304c68"},"children":[{"type":"text","value":"\"systemctl restart mosquitto\""}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"opções"},"children":[{"type":"text","value":"Opções"}]},{"type":"element","tag":"h3","props":{"id":"--pre-hook-pre_hook"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--pre-hook PRE_HOOK"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comando a ser executado antes de obter um certificado.\nSe existirem vários hooks iguais somente um será executado."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Parar um servidor."}]}]},{"type":"element","tag":"h3","props":{"id":"--post-hook-post_hook"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--post-hook POST_HOOK"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comando a ser executado depois da tentativa de obter ou renovar o certificado.\nSe existirem vários hooks iguais somente um será executado."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Reiniciar/iniciar um servidor"}]}]},{"type":"element","tag":"h3","props":{"id":"--deploy-hook-deploy_hook"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--deploy-hook DEPLOY_HOOK"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comando a ser executado uma vez para cada certificado emitido.\nSão passados as seguintes variáveis para o shell:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"RENEWED_LINEAGE"}]},{"type":"text","value":" contendo o caminho certificado (p.e.\n"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/etc/letsencrypt/live/geraldo.dev"}]},{"type":"text","value":") que contém a chaves e o certificado."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"RENEWED_DOMAINS"}]},{"type":"text","value":" contem uma lista separada por espaço dos certificados renovados (p.e. "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"geraldo.dev www.geraldo.dev"}]},{"type":"text","value":")"}]}]},{"type":"element","tag":"h3","props":{"id":"--disable-hook-validation"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--disable-hook-validation"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Manual: Ordinarily the commands specified for --pre-\nhook/--post-hook/--deploy-hook will be checked for validity, to see if the\nprograms being run are in the $PATH, so that mistakes can be caught early, even\nwhen the hooks aren't being run just yet. The validation is rather simplistic\nand fails if you use more advanced shell constructs, so you can use this switch\nto disable it. (default: False)"}]}]},{"type":"element","tag":"h3","props":{"id":"--no-directory-hooks"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--no-directory-hooks"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Manual: Disable running executables found in Certbot's hook directories\nduring renewal. (default: False)"}]}]},{"type":"element","tag":"h2","props":{"id":"referências"},"children":[{"type":"text","value":"Referências"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-the-mosquitto-mqtt-messaging-broker-on-debian-8","rel":["nofollow"]},"children":[{"type":"text","value":"How to Install and Secure the Mosquitto MQTT Messaging Broker on Debian 8"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-304c68{color:#E6DB74}.ct-d284ed{color:#F92672}.ct-acdc60{color:#F8F8F2}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"exemplo","depth":2,"text":"Exemplo"},{"id":"opções","depth":2,"text":"Opções","children":[{"id":"--pre-hook-pre_hook","depth":3,"text":"--pre-hook PRE_HOOK"},{"id":"--post-hook-post_hook","depth":3,"text":"--post-hook POST_HOOK"},{"id":"--deploy-hook-deploy_hook","depth":3,"text":"--deploy-hook DEPLOY_HOOK"},{"id":"--disable-hook-validation","depth":3,"text":"--disable-hook-validation"},{"id":"--no-directory-hooks","depth":3,"text":"--no-directory-hooks"}]},{"id":"referências","depth":2,"text":"Referências"}]}},"_type":"markdown","_id":"content:til:certbot-hooks.md","_source":"content","_file":"til/certbot-hooks.md","_extension":"md"}]