<!DOCTYPE html>
<html lang="pt-br">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
<base href="https://geraldo.dev/">
<title>Feed Forward Neural Network no debian com mlpack | geraldo.dev</title>
<link rel="canonical" href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/">
<meta name="generator" content="Hugo 0.54.0" />


    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="29/04/2019">



    <meta property="og:image" content="https://geraldo.dev//img/headers/ffn.jpg" />
<meta property="og:description" content="Como criar usando C&#43;&#43; uma rede neural do tipo feed forward no Debian stable" /><meta property="og:url" content="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/" />
    <meta property="og:site_name" content="geraldo.dev" />
    <meta property="og:title" content="Feed Forward Neural Network no debian com mlpack" />


    <meta property="og:tags" content="ffn" />

    <meta property="og:tags" content="mlpack" />

    <meta property="og:tags" content="debian" />

    <meta property="og:tags" content="apt" />

    <meta property="og:tags" content="C&#43;&#43;" />

    <meta property="og:tags" content="cpp" />

    <meta property="og:tags" content="armadillo" />



<meta name="description" content="Como criar usando C&#43;&#43; uma rede neural do tipo feed forward no Debian stable">
<meta name="author" content="Geraldo Ribeiro">

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-139336679-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



<link rel="stylesheet" async href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" async href="https://cdn.materialdesignicons.com/2.8.94/css/materialdesignicons.min.css">



<link rel="stylesheet"
      href="https://geraldo.dev/style.main.min.9f12b66a9b95d665a852e082e59177e2964160ba39ba803f4e817a09586738bb.css"
      integrity="sha256-nxK2apuV1mWoUuCC5ZF34pZBYLo5uoA/ToF6CVhnOLs="
      media="screen" async>










</head>

<body>
    
        <header>
            <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper container">
        <a id="logo-container" href="https://geraldo.dev/" class="brand-logo">geraldo.dev</a>


        <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        <ul class="right hide-on-med-and-down">
            
<li><a href="/">Home</a></li>

<li><a href="/posts">Posts</a></li>

<li><a href="/publications">Artigos</a></li>

<li><a href="/projects">Projetos</a></li>


        </ul>
    </div>
</nav>

<ul class="sidenav" id="mobile-demo">
  
<li><a href="/">Home</a></li>

<li><a href="/posts">Posts</a></li>

<li><a href="/publications">Artigos</a></li>

<li><a href="/projects">Projetos</a></li>


</ul>


        </header>
    

    

    <main>
      <div class="page container">

        
        <div class="project-header center-align">
          <picture>
            <source srcset="/img/headers/ffn.webp" type="image/webp">
            <img src="/img/headers/ffn.jpg" class="responsive-img z-depth-3">
          </picture>
        </div>
        

        <div class="row">
          <div class="col s12 m6 center-align grey-text">
            Publicado em: 29/Apr/2019
          </div>
          
          <div class="col s12 m6 center-align grey-text">
            Atualizado em: 22/Jun/2020
          </div>
          
        </div>

        
        
        
            
              <div class="chip">
                  <a href="https://geraldo.dev/tags/ffn/">ffn</a>
                </div>
              <div class="chip">
                  <a href="https://geraldo.dev/tags/mlpack/">mlpack</a>
                </div>
              <div class="chip">
                  <a href="https://geraldo.dev/tags/debian/">debian</a>
                </div>
              <div class="chip">
                  <a href="https://geraldo.dev/tags/apt/">apt</a>
                </div>
              
              <div class="chip">
                  <a href="https://geraldo.dev/tags/cpp/">cpp</a>
                </div>
              <div class="chip">
                  <a href="https://geraldo.dev/tags/armadillo/">armadillo</a>
                </div>


        <h1>Feed Forward Neural Network no debian com mlpack</h1>

        
<aside class="table-of-contents">
  <header>
    <h3>Sumário</h3>
  </header>
  <ul>
<li>
<ul>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#versões-do-mlpack-disponíveis-do-debian">Versões do mlpack disponíveis do Debian</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#utilizando-pacotes-testing-junto-com-stable">Utilizando pacotes testing junto com stable</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#dados-de-treinamento">Dados de treinamento</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#implementação">Implementação</a>
<ul>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#carregando-as-dependências">Carregando as dependências</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#carregar-e-transpor-os-dados-do-arquivo-csv">Carregar e transpor os dados do arquivo CSV</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#constantes-para-os-índices">Constantes para os índices</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#dados-de-entrada-para-treinamento">Dados de entrada para treinamento</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#dados-de-saída-para-treinamento">Dados de saída para treinamento</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#dados-de-entrada-para-teste">Dados de entrada para teste</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#dados-de-saída-para-teste">Dados de saída para teste</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#visualizando-os-dados-de-teste">Visualizando os dados de teste</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#construindo-a-rede-neural">Construindo a rede neural</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#treinamento">Treinamento</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#testando-o-modelo-ajustado">Testando o modelo ajustado</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#salvando-modelo-para-continuar-depois">Salvando modelo para continuar depois</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#carregando-o-modelo-salvo-na-sessão-anterior">Carregando o modelo salvo na sessão anterior</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#nova-sessão-de-treinamento-para-refinar">Nova sessão de treinamento para refinar</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#novos-testes">Novos testes</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#salvando-o-modelo-atualizado">Salvando o modelo atualizado</a></li>
</ul></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#código-fonte-completo">Código fonte completo</a></li>
<li><a href="https://geraldo.dev/posts/cpp-mlpack-feed-forward-neural-network-no-debian/#referências">Referências</a></li>
</ul></li>
</ul>

</aside>




        <div class="gr-main-content">
        <p>Este artigo mostra como criar uma rede neural simples no
<a href="https://www.debian.org/releases/stable/" target="_blank">Debian stable</a> utilizando a
<a href="http://www.mlpack.org" target="_blank">mlpack</a>. A <code>mlpack</code> é uma biblioteca popular e de alta
performance para aprendizado de máquina em C++.</p>

<h2 id="versões-do-mlpack-disponíveis-do-debian">Versões do mlpack disponíveis do Debian</h2>

<p>As versões disponíveis no momento da escrita deste artigo são:</p>

<table>
<thead>
<tr>
<th align="center">Versão do Debian</th>
<th align="center">Versão do mlpack</th>
<th>Arquiteturas</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">jessie (oldstable)</td>
<td align="center">1.0.10-1</td>
<td>amd64 armel armhf i386</td>
</tr>

<tr>
<td align="center">stretch (stable)</td>
<td align="center">2.1.1-1</td>
<td>amd64 arm64 armel armhf i386 mips mips64el mipsel ppc64el s390x</td>
</tr>

<tr>
<td align="center">buster (testing)</td>
<td align="center">3.0.4-1</td>
<td>amd64 arm64 armel armhf i386 mips mips64el mipsel ppc64el s390x</td>
</tr>

<tr>
<td align="center">sid (unstable)</td>
<td align="center">3.0.4-1+b1</td>
<td>kfreebsd-amd64 kfreebsd-i386</td>
</tr>
</tbody>
</table>

<p>As versões do <code>libmlpack-dev</code> disponíveis para o <a href="http://debian.org" target="_blank">Debian</a> podem ser consultadas neste
<a href="https://packages.debian.org/search?keywords=libmlpack-dev&amp;searchon=names&amp;suite=all&amp;section=all" target="_blank">link</a>.</p>

<p>Neste artigo usaremos a versão <code>3.0.4</code> presente no <code>testing</code>.</p>

<h2 id="utilizando-pacotes-testing-junto-com-stable">Utilizando pacotes testing junto com stable</h2>

<p>Eu prefiro utilizar somente os pacotes <code>stable</code> nos servidores por serem
versões muito bem testadas. Normalmente as últimas versões não estão
disponíveis no repositório <code>stable</code>, mas sim nos repositórios <code>testing</code>
e <code>unstable</code>. O repositório <code>testing</code> contém próximo candidato a se tornar
<code>stable</code> de cada pacote. O repositório <code>unstable</code> contém a última versão
disponível de cada pacote.</p>

<p>Misturar repositórios diferente pode ser algo tranquilo de manter se feito com cuidado.
É só indicar <strong>precisamente</strong> qual pacote deve ser pego de cada repositório.
O Debian tem um mecanismo bem fácil de usar para realizar esta tarefa.
No meu caso eu tenho uma regra geral: <strong>pegar sempre do stable</strong> e algumas
poucas exceções para pacotes específicos.</p>

<p>Para mesclar diferentes repositórios basta <em>pinar</em> os pacotes para indicar quais versões serão usadas.</p>

<p>Para marcar o <code>mlpack</code> e o <code>armadillo</code> para serem instalados a partir do
<code>testing</code> crie um arquivo chamado <code>/etc/apt/preferences.d/mlpack</code> com
o seguinte conteúdo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Package: *mlpack*
Pin: release a=testing
Pin-Priority: 1002

Package: *armadillo*
Pin: release a=testing
Pin-Priority: 1002</code></pre></div>
<p>O arquivo <code>/etc/apt/preferences.d/mlpack</code> poderia ter qualquer nome, mas é conveniente usar algo descritivo.</p>

<p>E para desfazer a pinagem basta remover o arquivo.</p>

<p>Então é só proceder a instalação normal com o <code>apt</code> como de costume:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt install libmlpack-dev</code></pre></div>
<h2 id="dados-de-treinamento">Dados de treinamento</h2>

<p>Vamos utilizar dois grupos de dados, cada um com duas variáveis (x e y).</p>

<p>Olhando nosso conjunto de dados de cima podemos ver claramente duas curvas, uma para cada conjunto.</p>

<p><div class="center-align">
    <figure>
      <img class="responsive-img z-depth-3" src="/img/mlpack-foo-1.gif#center" alt="Grupo de dados de treinamento">
      <figcaption>Grupo de dados de treinamento</figcaption>
    </figure>
  </div></p>

<p>Para facilitar a visualização, o primeiro grupo está em <em>z=0</em> e o segundo em <em>z=1</em>, conforme pode ser visto na
animação abaixo. É mais ou menos isso que a rede deverá <em>aprender</em>.</p>

<p><div class="center-align">
    <figure>
      <img class="responsive-img z-depth-3" src="/img/mlpack-foo-2.gif#center" alt="Grupo de dados de treinamento">
      <figcaption>Grupo de dados de treinamento</figcaption>
    </figure>
  </div></p>

<p>O arquivo <code>foo.csv</code> contém as duas curvas com os pontos distribuídos do modo
aleatório para não favorecer ou influenciar o treinamento. São ao todo 400
linhas e 3 colunas. As duas primeiras colunas são as <strong>entradas</strong> e a terceira
é o <strong>grupo</strong> a qual pertencem.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csv" data-lang="csv">-1.336471627143056118e+00,3.770125142464317847e+00,0.000000000000000000e+00
1.804415958408375431e+00,2.999013679368799146e+00,1.000000000000000000e+00
1.401588838630331679e+00,3.746404773569839364e+00,0.000000000000000000e+00
9.741670427761830453e-01,3.361695788254598583e+00,1.000000000000000000e+00
-2.602637515616321284e+00,2.340144859256901189e+00,1.000000000000000000e+00
...</code></pre></div>
<h2 id="implementação">Implementação</h2>

<h3 id="carregando-as-dependências">Carregando as dependências</h3>

<p>Incluindo os cabeçalhos específicos para rede neural artificial (ANN).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;mlpack/core.hpp&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;mlpack/methods/ann/ffn.hpp&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;mlpack/methods/ann/layer/layer.hpp&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;mlpack/methods/ann/loss_functions/mean_squared_error.hpp&gt;</span><span style="color:#75715e">
</span></code></pre></div>
<p>Para deixar o código bem mais legível alguns namespaces serão usados por padrão.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> mlpack;
<span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> mlpack<span style="color:#f92672">::</span>ann;
<span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> mlpack<span style="color:#f92672">::</span>optimization;
<span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> arma;
<span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
<span style="color:#66d9ef">using</span> mlpack<span style="color:#f92672">::</span>data<span style="color:#f92672">::</span>Load;
<span style="color:#66d9ef">using</span> mlpack<span style="color:#f92672">::</span>data<span style="color:#f92672">::</span>Save;
</code></pre></div>
<h3 id="carregar-e-transpor-os-dados-do-arquivo-csv">Carregar e transpor os dados do arquivo CSV</h3>

<p>As matrizes do <a href="http://arma.sourceforge.net/" target="_blank">Armadillo</a> (pacote de álgebra linear do mlpack) são armazenada no
formato <code>column-major</code>; isto significa que no disco cada coluna é localizada
numa região contígua de memória. Veja
<a href="https://www.mlpack.org/doc/mlpack-3.1.0/doxygen/matrices.html" target="_blank">detalhes</a> na
documentação do <code>mlpack</code>.</p>

<p>Esta é uma conveniência bem interessante, pois para escrever os arquivos os
registros são entrados por linha e para processamento são tratados em colunas.</p>

<p>Então além de carregar é preciso transpor a matriz de dados.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  <span style="color:#75715e">// lança uma exceção std::runtime_error se não conseguir carregar. default false
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> THROW_EXCEPTION <span style="color:#f92672">=</span> true;
  <span style="color:#75715e">// transpôe a matriz depois de carregar. default true
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> TRANSPOSE_INPUT <span style="color:#f92672">=</span> true;
  Load( <span style="color:#e6db74">&#34;foo.csv&#34;</span>, data, THROW_EXCEPTION, TRANSPOSE_INPUT );
  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Linhas:  &#34;</span> <span style="color:#f92672">&lt;&lt;</span> data.n_rows <span style="color:#f92672">&lt;&lt;</span> endl; <span style="color:#75715e">// 3
</span><span style="color:#75715e"></span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Colunas: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> data.n_cols <span style="color:#f92672">&lt;&lt;</span> endl; <span style="color:#75715e">// 400
</span></code></pre></div>
<p>A matriz de dados foi carregada e precisa ser dividida entre dados de treinamento e dados de teste.</p>

<p><div class="center-align">
    <figure>
      <img class="responsive-img z-depth-3" src="/img/mlpack-data.svg#center" alt="Dados depois de carregados">
      <figcaption>Dados depois de carregados</figcaption>
    </figure>
  </div></p>

<p>É muito importante que o modelo nunca veja os dados de teste para que se tenha
uma boa generalização.</p>

<h3 id="constantes-para-os-índices">Constantes para os índices</h3>

<p>Para facilitar a leitura do fonte e evitar <em>números mágicos</em> no código defini algumas constantes convenientes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> VAR1_ROW  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> VAR2_ROW  <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> LABEL_ROW <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> FIRST_COL <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> LAST_COL  <span style="color:#f92672">=</span> data.n_cols <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">auto</span> TEST_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</code></pre></div>
<p>Note que neste caso serão usadas 10 amostras para teste.</p>

<h3 id="dados-de-entrada-para-treinamento">Dados de entrada para treinamento</h3>

<p>Usando a função <code>submat</code> vamos recortar uma porção dos dados para formar os dados de entrada para treinamento.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  <span style="color:#66d9ef">auto</span> firtsRow  <span style="color:#f92672">=</span> VAR1_ROW;
  <span style="color:#66d9ef">auto</span> firtsCol  <span style="color:#f92672">=</span> FIRST_COL;
  <span style="color:#66d9ef">auto</span> lastRow   <span style="color:#f92672">=</span> VAR2_ROW;
  <span style="color:#66d9ef">auto</span> lastCol   <span style="color:#f92672">=</span> LAST_COL <span style="color:#f92672">-</span> TEST_SIZE;
  mat  traindata <span style="color:#f92672">=</span> data.submat( firtsRow, firtsCol, lastRow, lastCol );
</code></pre></div>
<h3 id="dados-de-saída-para-treinamento">Dados de saída para treinamento</h3>

<p>Usando a função <code>submat</code> vamos recortar uma porção dos dados para formar os dados de saída para treinamento.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  firtsRow        <span style="color:#f92672">=</span> LABEL_ROW;
  lastRow         <span style="color:#f92672">=</span> LABEL_ROW;
  mat trainlabels <span style="color:#f92672">=</span> data.submat( firtsRow, firtsCol, lastRow, lastCol );
</code></pre></div>
<h3 id="dados-de-entrada-para-teste">Dados de entrada para teste</h3>

<p>Usando a função <code>submat</code> vamos recortar uma porção dos dados para formar os dados de entrada para teste.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  firtsRow     <span style="color:#f92672">=</span> VAR1_ROW;
  lastRow      <span style="color:#f92672">=</span> VAR2_ROW;
  firtsCol     <span style="color:#f92672">=</span> LAST_COL <span style="color:#f92672">-</span> TEST_SIZE <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
  lastCol      <span style="color:#f92672">=</span> LAST_COL;
  mat testdata <span style="color:#f92672">=</span> data.submat( firtsRow, firtsCol, lastRow, lastCol );
</code></pre></div>
<h3 id="dados-de-saída-para-teste">Dados de saída para teste</h3>

<p>Usando a função <code>submat</code> vamos recortar uma porção dos dados para formar os dados de saída para teste.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  firtsRow       <span style="color:#f92672">=</span> LABEL_ROW;
  lastRow        <span style="color:#f92672">=</span> LABEL_ROW;
  mat testlabels <span style="color:#f92672">=</span> data.submat( firtsRow, firtsCol, lastRow, lastCol );
</code></pre></div>
<h3 id="visualizando-os-dados-de-teste">Visualizando os dados de teste</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Dados de entrada para teste: </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> testdata <span style="color:#f92672">&lt;&lt;</span> endl;
  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Dados de saída para teste: </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> testlabels <span style="color:#f92672">&lt;&lt;</span> endl;
</code></pre></div>
<p>É importante notar que os dados de teste contém amostras de ambos os grupos
e estão distribuídos em todo o espaço de amostra.</p>

<pre><code>Dados de entrada para teste:
   0.7482   2.5516   2.1925  -1.3355   0.0608   0.6829  -2.6796  -0.6668  -2.9646  -2.8399
   3.9294   2.3957   2.7282   3.7705   3.9995   3.4327   2.2516   3.9440   1.8603   2.0458

Dados de saída para teste:
   0        1.0000   1.0000   0        0        1.0000   1.0000   0        1.0000   1.0000
</code></pre>

<h3 id="construindo-a-rede-neural">Construindo a rede neural</h3>

<p><div class="center-align">
    <figure>
      <img class="responsive-img z-depth-3" src="/img/mlpack-ffn.svg#center" alt="img">
      <figcaption>img</figcaption>
    </figure>
  </div></p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  <span style="color:#75715e">// Feed Forward Network
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// FFN&lt;tipo-de-saída-das-camadas, regra-de-inicialização&gt; model;
</span><span style="color:#75715e"></span>  FFN<span style="color:#f92672">&lt;</span>MeanSquaredError<span style="color:#f92672">&lt;&gt;</span>, RandomInitialization<span style="color:#f92672">&gt;</span> model;
  <span style="color:#75715e">// Adiciona camada com 2 entradas e 8 saídas
</span><span style="color:#75715e"></span>  model.Add<span style="color:#f92672">&lt;</span>Linear<span style="color:#f92672">&lt;&gt;&gt;</span>( traindata.n_rows, <span style="color:#ae81ff">8</span> );
  model.Add<span style="color:#f92672">&lt;</span>SigmoidLayer<span style="color:#f92672">&lt;&gt;&gt;</span>();
  <span style="color:#75715e">// Adiciona camada com 8 entradas e 8 saídas
</span><span style="color:#75715e"></span>  model.Add<span style="color:#f92672">&lt;</span>Linear<span style="color:#f92672">&lt;&gt;&gt;</span>( <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span> );
  model.Add<span style="color:#f92672">&lt;</span>SigmoidLayer<span style="color:#f92672">&lt;&gt;&gt;</span>();
  <span style="color:#75715e">// Adiciona camada com 8 entradas e 1 saída
</span><span style="color:#75715e"></span>  model.Add<span style="color:#f92672">&lt;</span>Linear<span style="color:#f92672">&lt;&gt;&gt;</span>( <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">1</span> );
  model.Add<span style="color:#f92672">&lt;</span>SigmoidLayer<span style="color:#f92672">&lt;&gt;&gt;</span>();
</code></pre></div>
<h3 id="treinamento">Treinamento</h3></p>

<p>A partir da inicialização aleatória dos pesos da conexões inicia-se o treinamento.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>; <span style="color:#f92672">++</span>i ) {
    model.Train( traindata, trainlabels );
    <span style="color:#75715e">// Acompanha o erro do modelo
</span><span style="color:#75715e"></span>    mat assignments;
    model.Predict( testdata, assignments );
    <span style="color:#75715e">// Diferença entre o obtido e o esperado
</span><span style="color:#75715e"></span>    mat diff <span style="color:#f92672">=</span> assignments <span style="color:#f92672">-</span> testlabels;
    cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Erro: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> diff <span style="color:#f92672">*</span> diff.t();
  }
</code></pre></div>
<p>Note o erro sendo reduzido a cada treinamento.</p>

<pre><code>Erro:    0.0292
Erro:    0.0058
Erro:    0.0038
Erro:    0.0024
</code></pre>

<h3 id="testando-o-modelo-ajustado">Testando o modelo ajustado</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  mat assignments;
  model.Predict( testdata, assignments );
  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Previsões:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> assignments <span style="color:#f92672">&lt;&lt;</span> endl;
  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Classificação correta:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> testlabels <span style="color:#f92672">&lt;&lt;</span> endl;
</code></pre></div>
<p>Saída:</p>

<pre><code>Previsões:
   0.0074   0.9985   0.9918   0.0097   0.0057   0.9853   0.9998   0.0107   1.0000   1.0000

Classificação correta:
   0        1.0000   1.0000   0        0        1.0000   1.0000   0        1.0000   1.0000
</code></pre>

<h3 id="salvando-modelo-para-continuar-depois">Salvando modelo para continuar depois</h3>

<p>O modelo pode ser salvo a qualquer momento e recarregado para continuar o treinamento.
Um arquivo <code>XML</code> serializado pelo <code>boost</code> é salvo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  Save( <span style="color:#e6db74">&#34;model.xml&#34;</span>, <span style="color:#e6db74">&#34;model&#34;</span>, model, false );
</code></pre></div>
<h3 id="carregando-o-modelo-salvo-na-sessão-anterior">Carregando o modelo salvo na sessão anterior</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  Load( <span style="color:#e6db74">&#34;model.xml&#34;</span>, <span style="color:#e6db74">&#34;model&#34;</span>, model );
</code></pre></div>
<h3 id="nova-sessão-de-treinamento-para-refinar">Nova sessão de treinamento para refinar</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>; <span style="color:#f92672">++</span>i ) {
    model.Train( traindata, trainlabels );
  }
</code></pre></div>
<h3 id="novos-testes">Novos testes</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  model.Predict( testdata, assignments );
  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Previsões:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> assignments <span style="color:#f92672">&lt;&lt;</span> endl;
  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Classificação correta:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&lt;</span> testlabels <span style="color:#f92672">&lt;&lt;</span> endl;
</code></pre></div>
<p>Saída:</p>

<pre><code>Previsões:
   0.0045   0.9996   0.9893   0.0010   0.0049   0.9942   1.0000   0.0076   1.0000   1.0000

Classificação correta:
   0        1.0000   1.0000   0        0        1.0000   1.0000   0        1.0000   1.0000
</code></pre>

<p><h3 id="salvando-o-modelo-atualizado">Salvando o modelo atualizado</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">  Save( <span style="color:#e6db74">&#34;model2.xml&#34;</span>, <span style="color:#e6db74">&#34;model&#34;</span>, model, false );
</code></pre></div>
<h2 id="código-fonte-completo">Código fonte completo</h2></p>

<p>O código fonte completo pode ser encontrado no
<a href="https://github.com/geraldolsribeiro/mlpack-tutorials/tree/master/ffn" target="_blank">github</a>.</p>

<p><p>Para baixar e compilar o fonte deste artigo utilize:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone <a href="https://github.com/geraldolsribeiro/mlpack-tutorials/" target="_blank">https://github.com/geraldolsribeiro/mlpack-tutorials/</a>
cd mlpack-tutorials/ffn
make</code></pre></div>
<h2 id="referências">Referências</h2></p>

<ul>
<li><a href="https://wiki.debian.org/AptPreferences" target="_blank">Apt Preferences</a></li>
<li><a href="https://www.mlpack.org/doc/mlpack-3.1.0/doxygen/anntutorial.html" target="_blank">Neural Network Tutorial</a></li>
</ul>

        </div>

        

<div class="share-box center-align" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
        href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fgeraldo.dev%2fposts%2fcpp-mlpack-feed-forward-neural-network-no-debian%2f"
        aria-label="share on Facebook"
        target="_blank" rel="noopener">
        <span class="mdi mdi-48px mdi-facebook"></span>
      </a>
    </li>

    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?url=https%3a%2f%2fgeraldo.dev%2fposts%2fcpp-mlpack-feed-forward-neural-network-no-debian%2f&amp;text=Feed%20Forward%20Neural%20Network%20no%20debian%20com%20mlpack"
         target="_blank" rel="noopener">
        <span class="mdi mdi-48px mdi-twitter"></span>
      </a>
    </li>

    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgeraldo.dev%2fposts%2fcpp-mlpack-feed-forward-neural-network-no-debian%2f&amp;title=Feed%20Forward%20Neural%20Network%20no%20debian%20com%20mlpack"
         target="_blank" rel="noopener">
        <span class="mdi mdi-48px mdi-linkedin"></span>
      </a>
    </li>

    <li>
      <a class="email"
         href="mailto:?subject=Feed%20Forward%20Neural%20Network%20no%20debian%20com%20mlpack&amp;body=https%3a%2f%2fgeraldo.dev%2fposts%2fcpp-mlpack-feed-forward-neural-network-no-debian%2f">
        <span class="mdi mdi-48px mdi-email"></span>
      </a>
    </li>

  </ul>
  <span>Compartilhe!</span>
</div>




        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "geraldo-dev" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <script>
var disqus_config = function () {
  this.language = "pt";
};
</script>

      </div>

    </main>


    
        <footer class="page-footer orange">
  <div class="container">
    <div class="row">
      <div class="col l9 s12">
        <h5 class="white-text">Você tem uma grande ideia?</h5>
        <p class="grey-text text-lighten-4">
          <ul>
            
          </ul>
        </p>

        <p class="grey-text text-lighten-4">
          Vamos marcar um café, talvez a solução seja muito mais simples do que você imagina.
        </p>
      </div>
      <div class="col l3 s12">
        <h5 class="white-text">Contatos</h5>
        <ul>
        
          <li>
            <a class="white-text" href="https://geraldo.dev">
              <span class="mdi mdi-24px mdi-web"></span>
              https://geraldo.dev
            </a>
          </li>
        
          <li>
            <a class="white-text" href="mailto:geraldolsribeiro@gmail.com">
              <span class="mdi mdi-24px mdi-email"></span>
              geraldo@intmain.io
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://api.whatsapp.com/send?phone=5512982302703&amp;text=Ol%c3%a1%20Geraldo!">
              <span class="mdi mdi-24px mdi-whatsapp"></span>
              (12) 9 8230 2703
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://twitter.com/geraldo_dev">
              <span class="mdi mdi-24px mdi-twitter"></span>
              geraldo_dev
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://www.instagram.com/geraldo.dev/">
              <span class="mdi mdi-24px mdi-instagram"></span>
              geraldo.dev
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://www.linkedin.com/in/geraldolsribeiro/">
              <span class="mdi mdi-24px mdi-linkedin"></span>
              geraldolsribeiro
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://www.facebook.com/geraldolsribeiro">
              <span class="mdi mdi-24px mdi-facebook"></span>
              geraldolsribeiro
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://github.com/geraldolsribeiro">
              <span class="mdi mdi-24px mdi-github-circle"></span>
              geraldolsribeiro
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://t.me/geraldolsribeiro">
              <span class="mdi mdi-24px mdi-telegram"></span>
              geraldolsribeiro
            </a>
          </li>
        
          <li>
            <a class="white-text" href="#ZgotmplZ">
              <span class="mdi mdi-24px mdi-skype"></span>
              geraldolsribeiro
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://codepen.io/geraldolsribeiro/">
              <span class="mdi mdi-24px mdi-codepen"></span>
              geraldolsribeiro
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://stackoverflow.com/users/554111/geraldo-luis-da-silva-ribeiro">
              <span class="mdi mdi-24px mdi-stack-overflow"></span>
              Stack overflow
            </a>
          </li>
        
          <li>
            <a class="white-text" href="https://scholar.google.com.br/citations?user=qsuG5ZkAAAAJ">
              <span class="mdi mdi-24px mdi-school"></span>
              Google Scholar
            </a>
          </li>
        
        </ul>
      </div>
    </div>
  </div>

    <div class="fixed-action-btn">
      <a class="btn-floating btn-large waves-effect waves-light ">
        <i class="large material-icons">chat</i>
      </a>
      <ul>
        
        
          <li>
              <a class="btn-floating waves-effect waves-light green darken-4"
                title="Chame pelo whatsapp!"
                target="_blank"
                href="https://api.whatsapp.com/send?phone=5512982302703&amp;text=Ol%c3%a1,%20Geraldo!">
              <span class="mdi mdi-24px mdi-whatsapp"></span>
            </a>
          </li>
        
      </ul>
    </div>


  <div class="footer-copyright">
    <div class="container">
      Feito com <i class="material-icons yellow-text" style="vertical-align: middle;">favorite</i> por Geraldo Ribeiro
    </div>
  </div>
</footer>

    

    
        






<script type="text/javascript" src="https://geraldo.dev/app.min.279059c89e89e0aaac782e66d27b61efd80e8c62da4721db90f688b8c88612bd.js" integrity="sha256-J5BZyJ6J4KqseC5m0nth79gOjGLaRyHbkPaIuMiGEr0=" media="screen"></script>


    
</body>
</html>
