<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Description not defined">
    <title>Escolhendo versões dos pacotes no Debian/Ubuntu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/cpp.min.js"></script>
    <link rel="stylesheet" href="/styles.css">
  </head>
  <body class="bg-black">
    <nav class="bg-slate-800 text-blue-400 border-gray-200 px-2 sm:px-4 py-2.5">
      <div class="container flex flex-wrap justify-between items-center mx-auto"><a class="flex items-center" href="/"><img class="mr-3 h-6 sm:h-9" src="/logo.svg" alt="Geraldo Ribeiro"><span class="self-center text-xl font-semibold whitespace-nowrap underline-offset-8 hover:underline hover:text-white"> Geraldo Ribeiro </span></a>
        <ul class="hidden fixed top-0 right-0 px-10 py-16 bg-gray-800 z-30 md:relative md:flex md:p-0 md:bg-transparent md:flex-row md:space-x-6">
          <li class="z-40 fixed top-4 right-6 md:hidden"><a class="text-right text-blue-500 text-4xl font-bold" href="javascript:void(0)">&times;</a></li>
          <li><a class="block py-2 pr-4 pl-3 text-blue-400 underline-offset-8 hover:text-white hover:underline md:p-0" href="/about.html" aria-current="page">About</a></li>
          <li><a class="block py-2 pr-4 pl-3 text-blue-400 underline-offset-8 hover:text-white hover:underline md:p-0" href="/tils.html" aria-current="page">Today I Learned</a></li>
          <li><a class="block py-2 pr-4 pl-3 text-blue-400 underline-offset-8 hover:text-white hover:underline md:p-0" href="/projects.html" aria-current="page">Projects</a></li>
          <li><a class="block py-2 pr-4 pl-3 text-blue-400 underline-offset-8 hover:text-white hover:underline md:p-0" href="/papers.html" aria-current="page">Papers</a></li>
          <li><a class="block py-2 pr-4 pl-3 text-blue-400 underline-offset-8 hover:text-white hover:underline md:p-0" href="/certificates.html" aria-current="page">Certificates</a></li>
        </ul>
        <div class="flex mr-2 items-center md:hidden"><a class="text-slate-500 text-2xl font-bold opacity-70 duration-300 hover:opacity-100" href="javascript:void(0)"> &#x2630; </a></div>
      </div>
    </nav>
    <div class="bg-black text-slate-100 min-h-screen">
      <main class="bg-slate-900 max-w-prose mx-auto prose prose-invert text-slate-400 p-4"><a class="text-slate-400 block cursor-pointer hover:text-slate-200" href="/tils.html">
          <svg class="inline h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
          </svg><span>Back to TILs</span></a>
        <h1>Escolhendo versões dos pacotes no Debian/Ubuntu</h1>
        <div class="flex flex-wrap"><a class="tag" href="/til/tag/sysadmin.html">sysadmin</a><a class="tag" href="/til/tag/linux.html">linux</a><a class="tag" href="/til/tag/debian.html">debian</a><a class="tag" href="/til/tag/ubuntu.html">ubuntu</a><a class="tag" href="/til/tag/hugo.html">hugo</a><a class="tag" href="/til/tag/apt.html">apt</a>
        </div><h2 id="parte-1---regra-geral" tabindex="-1">Parte 1 - Regra geral</h2>
<p>Antes de começar a escolher versões vamos estabelecer que todos os pacotes usarão a versão <code>stable</code> por padrão.</p>
<p>No arquivo <code>/etc/apt/preferences</code> (que deve estar vazio inicialmente) acrescente as seguintes linhas:</p>
<pre><code class="language-bash"># Arquivo: /etc/apt/preferences

# Todos os pacotes vem do stable por padrão
Package: *
Pin: release a=stable
Pin-Priority: 1001

Package: *
Pin: release a=testing
Pin-Priority: 650

Package: *
Pin: release a=unstable
Pin-Priority: 600
</code></pre>
<p>O valor acima de 1000 vai forçar os pacotes que foram instalados na mão usando outras versões a voltarem para o <code>stable</code>.</p>
<p>Agora que já definimos uma REGRA GERAL podemos começar a definir as exceções à regra.</p>
<h2 id="parte-2---exce%C3%A7%C3%B5es-%C3%A0-regra-geral" tabindex="-1">Parte 2 - Exceções à regra geral</h2>
<h3 id="por-target" tabindex="-1">Por target</h3>
<p>Para exemplo vamos escolher o pacote <code>hugo</code> para este post.
Você pode usar este mesmo procedimento para qualquer pacote.</p>
<p>Se você acessar <a href="https://packages.debian.org/search?keywords=hugo">https://packages.debian.org/search?keywords=hugo</a> encontrará as seguintes versões:</p>
<ul>
<li>stable 0.18.1</li>
<li>testing 0.55.6</li>
<li>unstable 0.55.6</li>
</ul>
<p {&lt;="" notice="">{{&lt; notice tip &gt;}}
Crie um arquivo dentro do diretório <code>/etc/apt/preferences.d/</code> com o nome do
pacote que você quer especificar a versão. Pode ser qualquer nome aqui, mas
usando o nome do pacote fica mais fácil de manter o sistema.</p>
<pre><code class="language-bash"># /etc/apt/preferences.d/hugo
Package: hugo
Pin: release a=testing
Pin-Priority: 1002
</code></pre>
<p>Observe que a prioridade precisa ser maior que a prioridade da regra padrão para funcionar.</p>
<h3 id="por-origem" tabindex="-1">Por origem</h3>
<p>Ao instalar o pacote <code>nodejs</code> a versão <code>4.8</code> será instalada pois é a mais recente que está no repositório padrão.</p>
<pre><code class="language-bash">apt install nodejs
...
Obter:1 http://ftp.br.debian.org/debian stretch/main amd64 nodejs amd64 4.8.2~dfsg-1 [3.440 kB]
...
</code></pre>
<p>Para pegar a versão mais rescente do <code>nodejs</code> diretamente do <code>deb.nodesource.com</code> em vez do repositório padrão do Debian use:</p>
<pre><code class="language-bash"># /etc/apt/preferences.d/nodejs
Package: *
Pin: origin deb.nodesource.com
Pin-Priority: 1001
</code></pre>
<p>Então basta executar o comando de instalação novamente para que o pacote seja atualizado para a versão <code>12</code>.</p>
<pre><code class="language-bash">apt update
apt install nodejs
...
Obter:1 https://deb.nodesource.com/node_12.x stretch/main amd64 nodejs amd64 12.6.0-1nodesource1 [16,9 MB]
...
</code></pre>
<h2 id="parte-3---upgrade%2Fdowngrade" tabindex="-1">Parte 3 - Upgrade/Downgrade</h2>
<p>Agora que todas as nossas regras já estão definida basta atualizar que os pacotes vão para a versões escolhidas.</p>
<pre><code class="language-bash">apt-get update
apt-get upgrade
apt-get dist-upgrade
</code></pre>
<p>Note que alguns pacotes podem sofrer downgrade nesta atualização.</p>
<p>Só para conferir que a versão escolhida foi realmente instalada:</p>
<pre><code class="language-text">$ dpkg -l | grep hugo
ii  hugo 0.55.6+really0.54.0-1 amd64 Fast and flexible Static Site Generator written in Go
</code></pre>
<h2 id="entendendo-os-valores-das-prioridades" tabindex="-1">Entendendo os valores das prioridades</h2>
<h3 id="p-%3E-1000" tabindex="-1">P &gt; 1000</h3>
<p>Instala mesmo que precise baixar a versão de algum pacote já instalado.
Somente prioridades acima de 1000 permitem downgrade.</p>
<h3 id="990-%3C-p-%3C%3D-1000" tabindex="-1">990 &lt; P &lt;= 1000</h3>
<p>Instala somente se uma versão maior estiver disponível no <strong>target release</strong> (Ver variáel APT::Default-Release para detalhes).
Não permite downgrade de pacote instalado.</p>
<h3 id="500-%3C-p-%3C%3D-990" tabindex="-1">500 &lt; P &lt;= 990</h3>
<p>Instala somente se uma versão maior estiver disponível no <strong>target release</strong> (Ver variáel APT::Default-Release para detalhes).</p>
<h3 id="100-%3C-p-%3C%3D-500" tabindex="-1">100 &lt; P &lt;= 500</h3>
<p>Utilizado como predefinição para os arquivos NotAutomatic e ButAutomaticUpgrades</p>
<p>Instala a menos que exista uma versão disponível em outra distribuição ou se a versão instalada for mais recente.</p>
<blockquote>
<p>causes a version to be installed unless there is a version available
belonging to some other distribution or the installed version is more recent</p>
</blockquote>
<h3 id="0-%3C-p-%3C%3D-100" tabindex="-1">0 &lt; P &lt;= 100</h3>
<p>Instala somente se não possuir versão instalada do pacote.</p>
<h3 id="p-%3D%3D-1" tabindex="-1">P == 1</h3>
<p>Valor padrão para NotAutomatic</p>
<h3 id="p-%3C-0" tabindex="-1">P &lt; 0</h3>
<p>Nunca instala o pacote mesmo que o pacote seja recomendado.</p>

      </main>
    </div>
    <footer class="bg-slate-500 text-slate-400 text-center pb-16">
      <div class="py-4 bg-slate-800">&copy; Geraldo Ribeiro 2022</div>
      <div class="max-w-prose mx-auto py-4 grid gap-y-8 grid-cols-3 justify-items-center md:grid-cols-5 lg:grid-cols-10"><a class="mx-2" href="mailto:geraldolsribeiro@gmail.com" target="_blank"><img class="h-12 w-12" title="E-mail" alt="E-mail" src="/social-email.svg"></a><a class="mx-2" href="https://www.linkedin.com/in/geraldolsribeiro/" target="_blank"><img class="h-12 w-12" title="Linkedin" alt="Linkedin" src="/social-linkedin.svg"></a><a class="mx-2" href="https://github.com/geraldolsribeiro" target="_blank"><img class="h-12 w-12" title="Github" alt="Github" src="/social-github.svg"></a><a class="mx-2" href="https://codepen.io/geraldolsribeiro/" target="_blank"><img class="h-12 w-12" title="Codepen" alt="Codepen" src="/social-codepen.svg"></a><a class="mx-2" href="https://twitter.com/geraldo_dev" target="_blank"><img class="h-12 w-12" title="Twitter" alt="Twitter" src="/social-twitter.svg"></a><a class="mx-2" href="https://t.me/geraldolsribeiro" target="_blank"><img class="h-12 w-12" title="Telegram" alt="Telegram" src="/social-telegram.svg"></a><a class="mx-2" href="https://api.whatsapp.com/send?phone=5512982302703&amp;text=Hi%20Geraldo!" target="_blank"><img class="h-12 w-12" title="Whatsapp" alt="Whatsapp" src="/social-whatsapp.svg"></a><a class="mx-2" href="https://www.instagram.com/geraldo.dev/" target="_blank"><img class="h-12 w-12" title="Instagram" alt="Instagram" src="/social-instagram.svg"></a><a class="mx-2" href="https://www.facebook.com/geraldolsribeiro" target="_blank"><img class="h-12 w-12" title="Facebook" alt="Facebook" src="/social-facebook.svg"></a><a class="mx-2" href="https://stackoverflow.com/users/554111/geraldo-luis-da-silva-ribeiro" target="_blank"><img class="h-12 w-12" title="StackOverflow" alt="StackOverflow" src="/social-stackoverflow.svg"></a>
      </div>
    </footer>
    <script>
      //- hljs.highlightAll();
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((el) => {
          hljs.highlightElement(el);
        });
      });
    </script>
  </body>
</html>